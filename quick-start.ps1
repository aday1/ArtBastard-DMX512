Write-Host "‚ö° ArtBastard DMX512 - TURBO QUICK START" -ForegroundColor Yellow
Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Yellow
Write-Host "ULTRA-FAST startup with VERBOSE feedback!" -ForegroundColor White
Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Yellow
Write-Host ""

$startTime = Get-Date
Write-Host "üïê Start Time: $(Get-Date -Format 'HH:mm:ss.fff')" -ForegroundColor Cyan

# Lightning-fast process cleanup
Write-Host "üîÑ [00.1s] Lightning Process Cleanup..." -ForegroundColor Cyan
$cleanupStart = Get-Date
try {
    Write-Host "  üîç Scanning for port 3030 conflicts..." -ForegroundColor White
    $connections = Get-NetTCPConnection -LocalPort 3030 -ErrorAction SilentlyContinue
    if ($connections) {
        Write-Host "  ‚ö° Found conflicting processes - terminating immediately..." -ForegroundColor Yellow
        $processes = $connections | Select-Object -ExpandProperty OwningProcess -Unique
        foreach ($pid in $processes) {
            Write-Host "    üíÄ Killing PID: $pid" -ForegroundColor Red
            Stop-Process -Id $pid -Force -ErrorAction SilentlyContinue
        }
        Write-Host "  ‚úÖ Port 3030 cleared in $([math]::Round((Get-Date - $cleanupStart).TotalMilliseconds))ms" -ForegroundColor Green
    } else {
        Write-Host "  ‚úÖ Port 3030 already free - no conflicts detected" -ForegroundColor Green
    }
} catch {
    Write-Host "  ‚úÖ Port cleanup completed (no active connections)" -ForegroundColor Green
}

# Turbo dependency verification
Write-Host "üîç [00.2s] TURBO Dependency Verification..." -ForegroundColor Cyan
$depStart = Get-Date
$missingItems = @()
$warnings = @()
$canStart = $true

# Rapid Node.js check
Write-Host "  üîé Checking Node.js installation..." -ForegroundColor White
try {
    $nodeVersion = node --version 2>$null
    if ($nodeVersion) {
        Write-Host "  ‚úÖ Node.js: $nodeVersion - READY" -ForegroundColor Green
    } else {
        Write-Host "  ‚ùå Node.js: Command failed - NOT FOUND" -ForegroundColor Red
        $missingItems += "Node.js not found"
        $canStart = $false
    }
} catch {
    Write-Host "  ‚ùå Node.js: Not installed - CRITICAL ERROR" -ForegroundColor Red
    $missingItems += "Node.js not installed"
    $canStart = $false
}

# Rapid npm check
Write-Host "  üîé Checking npm package manager..." -ForegroundColor White
try {
    $npmVersion = npm --version 2>$null
    if ($npmVersion) {
        Write-Host "  ‚úÖ npm: v$npmVersion - READY" -ForegroundColor Green
    } else {
        Write-Host "  ‚ùå npm: Command failed - NOT FOUND" -ForegroundColor Red
        $missingItems += "npm not found"
        $canStart = $false
    }
} catch {
    $missingItems += "npm not installed"
    $canStart = $false
}

# Check root dependencies
if (Test-Path "node_modules") {
    Write-Host "  ‚úÖ Root dependencies: Found" -ForegroundColor Green
} else {
    $missingItems += "Root node_modules missing"
    $warnings += "Run: npm install"
}

# Check frontend dependencies
if (Test-Path "react-app/node_modules") {
    Write-Host "  ‚úÖ Frontend dependencies: Found" -ForegroundColor Green
} else {
    $missingItems += "Frontend node_modules missing"
    $warnings += "Run: cd react-app && npm install"
}

# Check backend build
if (Test-Path "dist") {
    Write-Host "  ‚úÖ Backend build: Found" -ForegroundColor Green
} else {
    $warnings += "Backend not built - will auto-build"
}

# Check frontend build
if (Test-Path "react-app/dist") {
    Write-Host "  ‚úÖ Frontend build: Found" -ForegroundColor Green
} else {
    $warnings += "Frontend not built - will auto-build"
}

Write-Host ""

# Handle missing critical items
if ($missingItems.Count -gt 0) {
    Write-Host "‚ùå MISSING CRITICAL ITEMS:" -ForegroundColor Red
    foreach ($item in $missingItems) {
        Write-Host "   ‚Ä¢ $item" -ForegroundColor Red
    }
    Write-Host ""
    
    if (-not $canStart) {
        Write-Host "üö® CANNOT START - CRITICAL DEPENDENCIES MISSING!" -ForegroundColor Red
        Write-Host ""
        Write-Host "üìã SOLUTION STEPS:" -ForegroundColor Yellow
        Write-Host "1. Install Node.js from: https://nodejs.org/" -ForegroundColor White
        Write-Host "2. Run the full setup: .\start.ps1" -ForegroundColor White
        Write-Host "3. Then use quick-start.ps1 for future launches" -ForegroundColor White
        Write-Host ""
        Write-Host "üí° TIP: Use .\start.ps1 for a complete clean setup!" -ForegroundColor Cyan
        exit 1
    } else {
        Write-Host "‚ö†Ô∏è  MISSING ITEMS DETECTED - OFFERING TURBO FIX..." -ForegroundColor Yellow
        Write-Host ""
        Write-Host "üöÄ TURBO INSTALL missing dependencies? [Y/N] (takes ~10s)" -ForegroundColor Cyan
        $response = Read-Host
        
        if ($response -eq "Y" -or $response -eq "y" -or $response -eq "yes" -or $response -eq "Yes") {
            Write-Host "üì¶ [01.0s] TURBO DEPENDENCY INSTALLATION..." -ForegroundColor Green
            $installStart = Get-Date
            
            if (-not (Test-Path "node_modules")) {
                Write-Host "  ‚ö° Installing root dependencies (silent mode)..." -ForegroundColor Cyan
                npm install --no-audit --no-fund --silent
                if ($LASTEXITCODE -ne 0) {
                    Write-Host "  ‚ùå Root dependency install failed!" -ForegroundColor Red
                    Write-Host "  üí° Use: .\start.ps1 for nuclear cleanup" -ForegroundColor Yellow
                    exit 1
                }
                Write-Host "  ‚úÖ Root dependencies installed" -ForegroundColor Green
            }
            
            if (-not (Test-Path "react-app/node_modules")) {
                Write-Host "  ‚ö° Installing frontend dependencies (silent mode)..." -ForegroundColor Cyan
                Set-Location react-app
                npm install --no-audit --no-fund --silent
                if ($LASTEXITCODE -ne 0) {
                    Write-Host "  ‚ùå Frontend dependency install failed!" -ForegroundColor Red
                    Write-Host "  üí° Use: .\start.ps1 for nuclear cleanup" -ForegroundColor Yellow
                    Set-Location ..
                    exit 1
                }
                Set-Location ..
                Write-Host "  ‚úÖ Frontend dependencies installed" -ForegroundColor Green
            }
            
            $installTime = [math]::Round((Get-Date - $installStart).TotalSeconds, 1)
            Write-Host "  ‚ö° TURBO install completed in ${installTime}s!" -ForegroundColor Green
        } else {
            Write-Host "‚è≠Ô∏è  Skipping dependency install - FORCE STARTING anyway..." -ForegroundColor Yellow
        }
    }
}

# Show warnings with timing
if ($warnings.Count -gt 0) {
    Write-Host "‚ö†Ô∏è  NON-CRITICAL WARNINGS:" -ForegroundColor Yellow
    foreach ($warning in $warnings) {
        Write-Host "   ‚Ä¢ $warning" -ForegroundColor Yellow
    }
    Write-Host ""
}

# ULTRA-FAST build check (no complex validation)
Write-Host "üèóÔ∏è  [01.5s] ULTRA-FAST Build Verification..." -ForegroundColor Cyan
$buildCheckStart = Get-Date

$needsBackendBuild = -not (Test-Path "dist/main.js")
$needsFrontendBuild = -not (Test-Path "react-app/dist/index.html")

if ($needsBackendBuild -or $needsFrontendBuild) {
    Write-Host "  üîß Missing builds detected - TURBO building..." -ForegroundColor Green
    
    if ($needsBackendBuild) {
        Write-Host "  üî® TURBO Backend Build (silent)..." -ForegroundColor Cyan
        $backendStart = Get-Date
        npm run build:fast > $null 2>&1
        if ($LASTEXITCODE -ne 0) {
            Write-Host "  ‚ùå Backend build failed!" -ForegroundColor Red
            Write-Host "  üí° Use: .\start.ps1 for nuclear cleanup + build" -ForegroundColor Yellow
            exit 1
        }
        $backendTime = [math]::Round((Get-Date - $backendStart).TotalSeconds, 1)
        Write-Host "  ‚úÖ Backend built in ${backendTime}s!" -ForegroundColor Green
    }
    
    if ($needsFrontendBuild) {
        Write-Host "  üî® TURBO Frontend Build (silent)..." -ForegroundColor Cyan
        $frontendStart = Get-Date
        Set-Location react-app
        npm run build > $null 2>&1
        if ($LASTEXITCODE -ne 0) {
            Write-Host "  ‚ùå Frontend build failed!" -ForegroundColor Red
            Write-Host "  üí° Use: .\start.ps1 for nuclear cleanup + build" -ForegroundColor Yellow
            Set-Location ..
            exit 1
        }
        Set-Location ..
        $frontendTime = [math]::Round((Get-Date - $frontendStart).TotalSeconds, 1)
        Write-Host "  ‚úÖ Frontend built in ${frontendTime}s!" -ForegroundColor Green
    }
} else {
    Write-Host "  ‚úÖ All builds exist - SKIPPING build phase!" -ForegroundColor Green
}

$buildCheckTime = [math]::Round((Get-Date - $buildCheckStart).TotalMilliseconds)
Write-Host "  ‚ö° Build verification completed in ${buildCheckTime}ms" -ForegroundColor Cyan
Write-Host ""

# INSTANT final verification (no complex checks)
Write-Host "üîç [01.8s] INSTANT Final Check..." -ForegroundColor Cyan
$verifyStart = Get-Date

$criticalFiles = @(
    @{Path="dist/main.js"; Name="Backend Main"},
    @{Path="react-app/dist/index.html"; Name="Frontend Index"}
)

$allReady = $true
foreach ($file in $criticalFiles) {
    if (Test-Path $file.Path) {
        Write-Host "  ‚úÖ $($file.Name): READY" -ForegroundColor Green
    } else {
        Write-Host "  ‚ùå $($file.Name): MISSING" -ForegroundColor Red
        $allReady = $false
    }
}

if (-not $allReady) {
    Write-Host ""
    Write-Host "üö® CRITICAL FILES MISSING!" -ForegroundColor Red
    Write-Host "üìã SOLUTION: Use .\start.ps1 for nuclear cleanup" -ForegroundColor Yellow
    exit 1
}

$verifyTime = [math]::Round((Get-Date - $verifyStart).TotalMilliseconds)
Write-Host "  ‚ö° Final verification in ${verifyTime}ms" -ForegroundColor Cyan
Write-Host ""

# TURBO LAUNCH SUCCESS
$totalStartupTime = [math]::Round((Get-Date - $startTime).TotalSeconds, 2)
Write-Host "üéØ TURBO START SEQUENCE COMPLETE!" -ForegroundColor Green
Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Green
Write-Host "‚ö° Total startup time: ${totalStartupTime}s (ULTRA-FAST!)" -ForegroundColor Yellow
Write-Host "üéõÔ∏è  All MIDI Learn/OSC controls active!" -ForegroundColor White
Write-Host "üöÄ Focus/Iris/Prism/ColorWheel/GoboRotation/Pan/Tilt available!" -ForegroundColor White
Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Green
Write-Host ""

# INSTANT browser launch (no waiting/monitoring)
Write-Host "üåê [02.0s] INSTANT Browser Launch..." -ForegroundColor Cyan
$url = "http://localhost:3030"
Write-Host "  üéØ Target URL: $url" -ForegroundColor White
Write-Host "  ‚ö° Pre-launching browser..." -ForegroundColor Yellow

# Start browser immediately (no waiting for server)
Start-Process $url -ErrorAction SilentlyContinue

# TURBO SERVER LAUNCH
Write-Host ""
Write-Host "üöÄ [02.1s] TURBO SERVER LAUNCH..." -ForegroundColor Green
Write-Host "  ‚ñ∂Ô∏è  Executing: npm start" -ForegroundColor Cyan
Write-Host "  üåü Server starting on port 3030..." -ForegroundColor Yellow
Write-Host "  üì± Frontend served from react-app/dist" -ForegroundColor Yellow
Write-Host "  üéõÔ∏è  DMX controls ready for MIDI Learn!" -ForegroundColor Yellow
Write-Host ""
Write-Host "üéØ LAUNCH INITIATED - Server output below:" -ForegroundColor Green
Write-Host "‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê" -ForegroundColor Gray

# Launch server with verbose startup info
try {
    npm start
} catch {
    Write-Host ""
    Write-Host "‚ùå SERVER LAUNCH FAILED!" -ForegroundColor Red
    Write-Host ""
    Write-Host "üîß TURBO TROUBLESHOOTING:" -ForegroundColor Yellow
    Write-Host "1. Use: .\start.ps1 (nuclear cleanup)" -ForegroundColor White
    Write-Host "2. Check error messages above" -ForegroundColor White
    Write-Host "3. Verify port 3030 is free" -ForegroundColor White
    Write-Host "4. Restart PowerShell as Admin" -ForegroundColor White
    Write-Host ""
}

Write-Host ""
Write-Host "‚ö° TURBO START session completed." -ForegroundColor Yellow
Write-Host "   For nuclear cleanup: .\start.ps1" -ForegroundColor White

